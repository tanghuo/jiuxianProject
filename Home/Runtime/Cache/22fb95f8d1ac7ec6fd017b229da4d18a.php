<?php if (!defined('THINK_PATH')) exit(); try{ $user="root"; $pass="123456789"; $PDO=new PDO("mysql:host=localhost;dbname=jiuxian",$user,$pass); $PDO->beginTransaction(); $query= queryPart(); $temp=$PDO->prepare($query); $temp->execute(); $result=$temp->fetchAll(PDO::FETCH_ASSOC); $PDO->commit(); if($result && $_POST['hide']){ $_SESSION['user']=$result["Name"]; $goto_path="/kuanjia/index.php/Index/userCenter"; echo "<script>"; echo "window.location.href='/kuanjia/index.php/Index/userCenter'"; echo "</script>"; echo 11; exit(); } echo json_encode($result); }catch(PDOException $e) { echo 'Connection failed: ' . $e->getMessage(); } function queryPart(){ if($_GET["way"]=="fifteen"){ return $query="select *
					from user LIMIT 14,1"; } else if($_GET["way"]=="butInit"){ return $query="select count(*)
					from user "; } elseif($_GET["b_val"]){ $mark=$_GET["b_val"]*15-15; if($mark<0){ $mark=0; } $_SESSION["make"]=$mark; return $query="select * from user LIMIT $mark,15"; } elseif($_POST['hide']){ $user=$_POST["user"]; $password=$_POST["password"]; return $query="select * from user where Name=$user and Password =$password"; } else { return $query="select * from user LIMIT 15"; } } ?>