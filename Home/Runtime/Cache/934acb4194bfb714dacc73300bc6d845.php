<?php if (!defined('THINK_PATH')) exit(); try{ $user="root"; $pass="123456789"; $PDO=new PDO("mysql:host=localhost;dbname=jiuxian",$user,$pass); $PDO->setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION ); $PDO->beginTransaction(); $query="insert sell(user_id,item_id,sell_receiver,sell_addr,sell_phone,sell_state,item_quantity,price_amount)  
				values(?,?,?,?,?,?,?,?)"; $temp=$PDO->prepare($query); $temp->bindParam(1, $user_id); $temp->bindParam(2, $item_id); $temp->bindParam(3, $sell_receiver); $temp->bindParam(4, $sell_addr); $temp->bindParam(5, $sell_phone); $temp->bindParam(6, $sell_state); $temp->bindParam(7, $item_quantity); $temp->bindParam(8, $price_amount); $user_id=$_GET["user_id"]; $item_id=$_GET["item_id"]; $sell_receiver=$_GET["sell_receiver"]; $sell_addr=$_GET["sell_addr"]; $sell_phone=$_GET["sell_phone"]; $sell_state="等待发货"; $item_quantity=$_GET["item_quantity"]; $price_amount=$_GET["price_amount"]; if($temp->execute()){ echo json_encode("success"); } else{ echo json_encode("failed"); } $query="delete from user_cart where user_id=? and item_id=?"; $temp=$PDO->prepare($query); $temp->bindParam(1, $user_id); $temp->bindParam(2, $item_id); $user_id=$_GET["user_id"]; $item_id=$_GET["item_id"]; $temp->execute(); $PDO->commit(); }catch(PDOException $e) { echo 'Connection failed: ' . $e->getMessage(); } ?>