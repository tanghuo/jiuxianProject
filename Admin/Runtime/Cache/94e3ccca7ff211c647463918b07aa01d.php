<?php if (!defined('THINK_PATH')) exit(); var_dump($_POST); var_dump($_FILES); try{ $user="root"; $pass="123456789"; $PDO=new PDO("mysql:host=localhost;dbname=jiuxian",$user,$pass); $PDO->setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION ); $PDO->beginTransaction(); $query = "select * from imgfile where img_id=?" ; $PDOD = $PDO->prepare($query) ; $PDOD -> bindParam(1, $temp_id) ; $temp_id = chkID($_POST["originate"]) ; $PDOD -> execute() ; if(!($PDOD->fetchAll(PDO::FETCH_ASSOC))){ $query="insert imgfile(img_id,img_name,img_path) values(?,?,?)"; $PDO2=$PDO->prepare($query); $PDO2->bindParam(1, $img_id); $PDO2->bindParam(2, $name); $PDO2->bindParam(3, $path); $img_id=chkID($_POST["originate"]); $name=$_FILES["imgFile"]["name"]; $path="./public/img/"; $path .= time() ; $path .= $name ; $PDO2 -> execute() ; if($_POST["item_detail"] && $_POST["item_price"]){ $query="insert shopitem(item_id,item_detail,item_price) values(?,?,?)"; $PDO2=$PDO->prepare($query); $PDO2->bindParam(1, $item_id); $PDO2->bindParam(2, $item_detail); $PDO2->bindParam(3, $item_price); $item_id=chkID($_POST["originate"]); $item_detail=$_POST["item_detail"]; $item_price=$_POST["item_price"]; $PDO2 -> execute() ; } if( move_uploaded_file($_FILES["imgFile"]["tmp_name"],$path)){ echo "upload success"; } else{ echo "upload failed"; } } else { $query="update imgFile set img_name=?,img_path=? where img_id=?"; $PDO2=$PDO->prepare($query); $PDO2->bindParam(1, $name); $PDO2->bindParam(2, $path); $PDO2->bindParam(3, $img_id); $img_id = chkID ( $_POST["originate"] ); $img_id=chkID($_POST["originate"]); $name=$_FILES["imgFile"]["name"]; $path="./public/img/"; $path .= time(); $path .= $name ; echo "<br/>"; echo $temp_id; echo "<br/>"; echo $name; echo $path; $PDO2 -> execute() ; if($_POST["item_detail"] && $_POST["item_price"]){ $query="update shopitem set item_detail=?,item_price=? where item_id=?"; $PDO2=$PDO->prepare($query); $PDO2->bindParam(1, $item_detail); $PDO2->bindParam(2, $item_price); $PDO2->bindParam(3, $item_id); $item_id=chkID($_POST["originate"]); $item_detail=$_POST["item_detail"]; $item_price=$_POST["item_price"]; $PDO2 -> execute() ; echo "word success"; } if( move_uploaded_file($_FILES["imgFile"]["tmp_name"],$path)){ echo "upload success"; } else{ echo "upload failed"; } } $PDO->commit(); } catch(PDOException $e){ print "Error!: " . $e->getMessage() . "<br/>"; $PDO->rollBack(); } function chkID($in){ switch ($in) { case 'adv1_top': return 1; break; case 'adv1_MainFoucs': $i=0; $base=10; if($_POST["picNum"]==(++$i)){ return ($base+$i); } if($_POST["picNum"]==(++$i)){ return ($base+$i); } if($_POST["picNum"]==(++$i)){ return ($base+$i); } if($_POST["picNum"]==(++$i)){ return ($base+$i); } ; break; case 'adv1_SubFoucs': $i=0; $base=20; if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } if($_POST["picNum_2"]==(++$i2)){ return $base+(4*($i-1))+$i2; } } break; case 'adv1_crazyBuy': $i=0; $base=100; if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 100+10*($i-1)+5*($i2-1)+$i3; } } } break; case 'adv1_indexTuanList': $i=0; if( $_POST["picNum_1"]==(++$i)){ return 160+$i; } if( $_POST["picNum_1"]==(++$i)){ return 160+$i; } if( $_POST["picNum_1"]==(++$i)){ return 160+$i; } if( $_POST["picNum_1"]==(++$i)){ return 160+$i; } if( $_POST["picNum_1"]==(++$i)){ return 160+$i; } break; case 'adv1_ADbox': return 200; break; case 'adv1_cDPl': $i=0; if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 200+6*($i-1)+$i2; } } break; case 'adv1_oneF_TLeft_box': $i=0; if($_POST["picNum_1"]==(++$i)){ return 250+$i; } if($_POST["picNum_1"]==(++$i)){ return 250+$i; } if($_POST["picNum_1"]==(++$i)){ return 250+$i; } break; case 'adv1_oneF_TRight': $i=0; if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } if($_POST["picNum_2"]==(++$i2)){ return 270+5*($i-1)+$i2; } } break; case 'adv1_oneF_Body_Bottom': $i=0; if($_POST["picNum_1"]==(++$i)){ return 280+$i; } if($_POST["picNum_1"]==(++$i)){ return 280+$i; } if($_POST["picNum_1"]==(++$i)){ return 280+$i; } if($_POST["picNum_1"]==(++$i)){ return 280+$i; } if($_POST["picNum_1"]==(++$i)){ return 280+$i; } break; case 'adv1_logoWall': $i=0; if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } } } if($_POST["picNum_1"]==(++$i)){ $i2=0; if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } } if($_POST["picNum_2"]==(++$i2)){ $i3=0; if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } if($_POST["picNum_3"]==(++$i3)){ return 300+($i-1)*18+($i2-1)*6+$i3; } } } } } ?>